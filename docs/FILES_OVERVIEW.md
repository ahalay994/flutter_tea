# Документация по файлам проекта "Tea App"

## lib/api/

### api_client.dart
**Назначение:** Базовый класс для HTTP-запросов  
**Основные функции:**
- Обработка HTTP-запросов (GET, POST, PUT, DELETE)
- Обработка ошибок и статусов ответов
- Аутентификация (при необходимости)
- Логирование запросов и ответов

### tea_api.dart
**Назначение:** Класс для работы с API чаёв  
**Основные функции:**
- `getTeas()` - получение списка всех чаёв
- `getFilteredTeas()` - получение отфильтрованных чаёв с пагинацией и поддержкой мульти-тенантности (deviceId) через эндпоинт /device-tea/pagination (также может использоваться для получения всех чаёв с пагинацией без фильтров)
- `saveTea()` - сохранение нового чая с поддержкой мульти-тенантности (deviceId) через эндпоинт /device-tea
- `updateTea()` - обновление существующего чая
- `deleteTea()` - удаление чая
- `getFilteredTeas()` - получение отфильтрованных чаёв
- `getFacets()` - получение фасетов с поддержкой мульти-тенантности (deviceId) через эндпоинт /device-tea/facets

### country_api.dart
**Назначение:** Класс для работы с API стран  
**Основные функции:**
- `getCountries()` - получение списка всех стран

### type_api.dart
**Назначение:** Класс для работы с API типов чаёв  
**Основные функции:**
- `getTypes()` - получение списка всех типов

### appearance_api.dart
**Назначение:** Класс для работы с API внешних видов  
**Основные функции:**
- `getAppearances()` - получение списка всех внешних видов

### flavor_api.dart
**Назначение:** Класс для работы с API вкусов  
**Основные функции:**
- `getFlavors()` - получение списка всех вкусов

### image_api.dart
**Назначение:** Класс для работы с API изображений  
**Основные функции:**
- `uploadImage()` - загрузка изображения
- `getImages()` - получение списка изображений

## lib/api/responses/

### tea_response.dart
**Назначение:** Модель ответа API для чая  
**Поля:**
- `id` - идентификатор чая
- `name` - название
- `countryId` - ID страны
- `typeId` - ID типа
- `appearanceId` - ID внешнего вида
- `temperature` - температура
- `brewingGuide` - руководство по завариванию
- `weight` - вес
- `description` - описание
- `flavors` - список ID вкусов
- `images` - список изображений

### country_response.dart
**Назначение:** Модель ответа API для страны  
**Поля:**
- `id` - идентификатор
- `name` - название
- `createdAt`, `updatedAt` - даты создания и обновления

### type_response.dart
**Назначение:** Модель ответа API для типа  
**Поля:**
- `id` - идентификатор
- `name` - название

### appearance_response.dart
**Назначение:** Модель ответа API для внешнего вида  
**Поля:**
- `id` - идентификатор
- `name` - название

### flavor_response.dart
**Назначение:** Модель ответа API для вкуса  
**Поля:**
- `id` - идентификатор
- `name` - название

### image_response.dart
**Назначение:** Модель ответа API для изображения  
**Поля:**
- `id` - идентификатор
- `url` - URL изображения
- `alt` - альтернативный текст

### api_response.dart
**Назначение:** Базовая модель ответа API  
**Поля:**
- `ok` - успешность запроса
- `message` - сообщение
- `data` - данные ответа

## lib/api/dto/

### create_tea_dto.dart
**Назначение:** Объект передачи данных для создания чая  
**Поля:**
- `name` - название чая
- `countryId` - ID страны
- `typeId` - ID типа
- `appearanceId` - ID внешнего вида
- `temperature` - температура заваривания
- `brewingGuide` - руководство по завариванию
- `weight` - вес
- `description` - описание
- `flavors` - список ID вкусов

## lib/models/

### tea.dart
**Назначение:** Модель данных для чая  
**Поля:**
- `id` - идентификатор
- `name` - название
- `country` - название страны (для отображения)
- `type` - название типа (для отображения)
- `appearance` - название внешнего вида (для отображения)
- `temperature` - температура заваривания
- `brewingGuide` - руководство по завариванию
- `weight` - вес
- `description` - описание
- `flavors` - список названий вкусов
- `images` - список URL изображений

**Методы:**
- `fromResponse()` - создание из API-ответа с заполнением названий
- `fromApiResponseForDatabase()` - создание для сохранения в базе (ID вместо названий)
- `fromLocalDB()` - создание из локальной базы данных
- `copyWith()` - копирование с изменением полей

### image.dart
**Назначение:** Модель данных для изображения  
**Поля:**
- `id` - идентификатор
- `url` - URL изображения
- `alt` - альтернативный текст

## lib/controllers/

### tea_controller.dart
**Назначение:** Основной контроллер приложения  
**Основные функции:**
- `fetchFullTeas()` (строки 320-440) - загрузка всех чаёв с пагинацией
- `fetchFilteredTeas()` (строки 500-620) - загрузка отфильтрованных чаёв
- `getTea()` (строки 623-650) - получение одного чая
- `createTeaWithResponse()` (строки 653-665) - создание чая
- `updateTea()` (строки 668-690) - обновление чая
- `deleteTea()` (строки 693-710) - удаление чая
- `applyFilters()` (строки 720-725) - применение фильтров

**Провайдеры:**
- `teaControllerProvider` - основной провайдер контроллера
- `teaListProvider` - провайдер списка чаёв
- `filteredTeaListProvider` - провайдер отфильтрованного списка
- `filterParamsProvider` - провайдер параметров фильтрации
- `filterTypeProvider` - провайдер типа фильтров

## lib/services/

### local_database_service.dart
**Назначение:** Сервис для работы с локальной базой данных SQLite  
**Основные функции:**
- `initDatabase()` - инициализация базы данных
- `insertTea()` - вставка чая
- `getTea()` - получение чая по ID
- `getFilteredTeas()` - получение отфильтрованных чаёв с пагинацией (также может использоваться для получения всех чаёв с пагинацией без фильтров)
- `getFilteredTeasWithNames()` - получение отфильтрованных чаёв с названиями
- `getTotalTeasCountWithFilters()` - общее количество чаёв с фильтрами
- `insertCountries()`, `getCountries()` - работа со странами
- `insertTypes()`, `getTypes()` - работа с типами
- `insertAppearances()`, `getAppearances()` - работа с внешними видами
- `insertFlavors()`, `getFlavors()` - работа с вкусами

### network_service.dart
**Назначение:** Сервис для проверки сетевого подключения  
**Основные функции:**
- `checkConnection()` - проверка подключения к интернету
- `connectionStatusStream` - поток статуса подключения
- `isConnected` - текущий статус подключения


**Назначение:** Сервис для кеширования изображений  
**Основные функции:**
- `cacheImage()` - кеширование отдельного изображения
- `cacheAllImages()` - кеширование всех изображений
- `clearCache()` - очистка кеша

### tea_service.dart
**Назначение:** Бизнес-сервис для работы с чаями  
**Основные функции:**
- `getTeaWithImages()` - получение чая с изображениями
- `createTea()` - создание чая с обработкой изображений
- `updateTea()` - обновление чая
- `deleteTea()` - удаление чая

### supabase_service.dart
**Назначение:** Сервис для работы с Supabase  
**Основные функции:**
- `initSupabase()` - инициализация клиента Supabase
- `uploadImage()` - загрузка изображения в Supabase Storage
- `getTable()` - получение таблицы из Supabase
- `insertRecord()` - вставка записи
- `updateRecord()` - обновление записи

## lib/screens/

### home/home_screen.dart
**Назначение:** Главный экран приложения  
**Основные функции:**
- Отображение списка чаёв
- Пагинация и бесконечный скролл
- Интеграция с фильтрами
- Обработка pull-to-refresh
- Отображение статуса подключения

**Состояния:**
- `_loadFirstPage()` - загрузка первой страницы
- `_loadMore()` - загрузка дополнительных данных
- `_scrollListener()` - слушатель скролла
- `_resetFilters()` - сброс фильтров

### add/add_screen.dart
**Назначение:** Экран добавления нового чая  
**Основные функции:**
- Форма для ввода данных чая
- Выбор и предварительный просмотр изображений
- Rich Text редакторы
- Валидация ввода
- Отправка данных на сервер

### edit/edit_screen.dart
**Назначение:** Экран редактирования чая  
**Основные функции:**
- Загрузка существующих данных
- Редактирование полей
- Обновление данных на сервере
- Сохранение изменений

### details/details_screen.dart
**Назначение:** Экран детального просмотра чая  
**Основные функции:**
- Отображение полной информации о чае
- Галерея изображений
- Рендеринг Rich Text контента
- Кнопки редактирования и удаления

## lib/screens/home/widgets/

### tea_drawer.dart
**Назначение:** Боковое меню с мультиселект фильтрами  
**Основные функции:**
- `TeaFilterDrawer` - основной виджет
- Фильтры по странам, типам, внешнему виду, вкусам
- Поиск внутри каждого списка фильтров
- Множественный выбор
- Применение и сброс фильтров

### tea_facet_filter_drawer.dart
**Назначение:** Боковое меню с фасетными фильтрами  
**Основные функции:**
- Отображение количества чаёв для каждого значения
- Фильтры с отображением количества результатов
- Сортировка по популярности
- Применение и сброс фильтров

### tea_card.dart
**Назначение:** Карточка отдельного чая  
**Основные функции:**
- Отображение основной информации
- Изображение чая
- Название и краткое описание
- Основные характеристики

## lib/screens/add/widgets/

### tea_form.dart
**Назначение:** Форма для добавления чая  
**Основные функции:**
- Поля ввода для всех атрибутов чая
- Валидация данных
- Выбор и загрузка изображений
- Rich Text редакторы

### image_uploader.dart
**Назначение:** Компонент загрузки изображений  
**Основные функции:**
- Выбор изображений из галереи
- Предварительный просмотр
- Удаление изображений
- Индикаторы загрузки

## lib/widgets/

### animated_loader.dart
**Назначение:** Анимированный индикатор загрузки  
**Основные функции:**
- Круговой индикатор прогресса
- Анимация загрузки
- Настраиваемый размер и цвет

### image_gallery_view.dart
**Назначение:** Галерея изображений  
**Основные функции:**
- Просмотр изображений в полноэкранном режиме
- Свайпы между изображениями
- Зум и панорамирование

### info_chip.dart
**Назначение:** Информационный чип  
**Основные функции:**
- Отображение краткой информации
- Настраиваемые цвета и стили
- Иконки и текст

## lib/providers/

### metadata_provider.dart
**Назначение:** Провайдер для метаданных (страны, типы, вкусы и т.д.)  
**Основные функции:**
- Хранение справочников
- Обновление данных
- Синхронизация с API

### connection_status_provider.dart
**Назначение:** Провайдер статуса подключения  
**Основные функции:**
- Отслеживание статуса интернета
- Уведомления об изменениях
- Интеграция с UI

## lib/utils/

### app_logger.dart
**Назначение:** Утилита для логирования  
**Основные функции:**
- `debug()` - отладочные сообщения
- `info()` - информационные сообщения
- `warning()` - предупреждения
- `error()` - ошибки с трейсом стека

### ui_helpers.dart
**Назначение:** Помощники для UI  
**Основные функции:**
- `showErrorDialog()` - отображение диалога ошибки
- `showSuccessDialog()` - отображение диалога успеха
- `showConfirmationDialog()` - отображение диалога подтверждения
- Вспомогательные методы форматирования

### json_utils.dart
**Назначение:** Утилиты для работы с JSON  
**Основные функции:**
- `safeJsonParse()` - безопасный парсинг JSON
- `toJsonSafe()` - безопасное преобразование в JSON
- Валидация JSON данных

### filter_type.dart
**Назначение:** Перечисление типов фильтров  
**Значения:**
- `multiSelect` - мультиселект фильтры
- `facets` - фасетные фильтры

## lib/helpers/

### data_mapper.dart
**Назначение:** Помощник для маппинга данных  
**Основные функции:**
- `getFieldById()` - получение поля по ID
- `getFieldsByIds()` - получение нескольких полей по ID
- `getFieldList()` - получение списка полей
- Утилиты для преобразования данных

## lib/main.dart
**Назначение:** Точка входа в приложение  
**Основные функции:**
- Инициализация проекта
- Загрузка переменных окружения
- Настройка провайдеров
- Запуск главного экрана